<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUGRAM - Мессенджер</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- ЭКРАН ЗАГРУЗКИ -->
    <div id="splashScreen" class="splash-screen">
        <div class="splash-content">
            <div class="logo-animation">
                <i class="fas fa-paper-plane"></i>
            </div>
            <h1 class="app-title">RUGRAM</h1>
            <p class="app-subtitle">Безопасный мессенджер</p>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>

    <!-- ЭКРАН АВТОРИЗАЦИИ -->
    <div id="authScreen" class="auth-screen hidden">
        
        <!-- Анимированный фон -->
        <div class="animated-bg">
            <div class="circle circle-1"></div>
            <div class="circle circle-2"></div>
            <div class="circle circle-3"></div>
        </div>

        <div class="auth-container">
            
            <!-- Логотип -->
            <div class="auth-logo-wrapper">
                <div class="auth-logo">
                    <i class="fas fa-paper-plane"></i>
                </div>
                <h1 class="auth-brand">RUGRAM</h1>
                <p class="auth-tagline">Общайся безопасно</p>
            </div>

            <!-- Переключатель форм -->
            <div class="form-tabs">
                <button class="tab-btn active" id="loginTab" onclick="switchTab('login')">
                    <i class="fas fa-sign-in-alt"></i> Вход
                </button>
                <button class="tab-btn" id="registerTab" onclick="switchTab('register')">
                    <i class="fas fa-user-plus"></i> Регистрация
                </button>
            </div>

            <!-- ФОРМА ВХОДА -->
            <div id="loginForm" class="auth-form active">
                <div class="form-content">
                    <div class="input-wrapper">
                        <i class="fas fa-envelope input-icon"></i>
                        <input type="email" id="loginEmail" placeholder="Введите email" class="form-input">
                    </div>
                    
                    <div class="input-wrapper">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="loginPassword" placeholder="Введите пароль" class="form-input">
                        <i class="fas fa-eye toggle-icon" onclick="togglePassword('loginPassword')"></i>
                    </div>

                    <button class="submit-btn" onclick="handleLogin()">
                        <span>Войти</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- ФОРМА РЕГИСТРАЦИИ -->
            <div id="registerForm" class="auth-form">
                <div class="form-content">
                    <div class="input-wrapper">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" id="registerName" placeholder="Ваше имя" class="form-input">
                    </div>

                    <div class="input-wrapper">
                        <i class="fas fa-at input-icon"></i>
                        <input type="text" id="registerUsername" placeholder="Username (латиница)" class="form-input">
                    </div>
                    
                    <div class="input-wrapper">
                        <i class="fas fa-envelope input-icon"></i>
                        <input type="email" id="registerEmail" placeholder="Email" class="form-input">
                    </div>
                    
                    <div class="input-wrapper">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="registerPassword" placeholder="Пароль (мин. 6)" class="form-input">
                        <i class="fas fa-eye toggle-icon" onclick="togglePassword('registerPassword')"></i>
                    </div>
                    
                    <div class="input-wrapper">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="registerPasswordConfirm" placeholder="Повторите пароль" class="form-input">
                    </div>

                    <button class="submit-btn" onclick="handleRegister()">
                        <span>Создать аккаунт</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

        </div>
    </div>

    <!-- ГЛАВНЫЙ ЭКРАН -->
    <div id="mainScreen" class="main-screen hidden">
        
        <!-- БОКОВАЯ ПАНЕЛЬ -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand">
                    <i class="fas fa-paper-plane brand-icon"></i>
                    <h2>RUGRAM</h2>
                </div>
                <button class="btn-icon" onclick="openNewChatDialog()">
                    <i class="fas fa-edit"></i>
                </button>
            </div>

            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchChats" placeholder="Поиск чатов...">
            </div>

            <div class="chats-list" id="chatsList">
                <div class="empty-state">
                    <i class="fas fa-comments"></i>
                    <p>Нет активных чатов</p>
                    <button class="start-chat-btn" onclick="openNewChatDialog()">
                        <i class="fas fa-plus"></i> Начать общение
                    </button>
                </div>
            </div>

            <div class="sidebar-footer">
                <div class="user-profile" onclick="openProfileDialog()">
                    <div class="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="profile-info">
                        <h4 id="sidebarName">Загрузка...</h4>
                        <p id="sidebarUsername">@username</p>
                    </div>
                    <i class="fas fa-cog settings-icon"></i>
                </div>
            </div>
        </aside>

        <!-- ОБЛАСТЬ ЧАТА -->
        <main class="chat-area">
            
            <div id="emptyChat" class="empty-chat">
                <div class="empty-content">
                    <div class="empty-icon">
                        <i class="fas fa-paper-plane"></i>
                    </div>
                    <h2>Добро пожаловать в RUGRAM</h2>
                    <p>Выберите чат или начните новую переписку</p>
                </div>
            </div>

            <div id="activeChat" class="active-chat hidden">
                <div class="chat-header">
                    <button class="btn-back" onclick="closeActiveChat()">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="chat-user">
                        <div class="chat-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="chat-info">
                            <h3 id="chatName">Имя</h3>
                            <p class="status" id="chatStatus">был(а) недавно</p>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button class="btn-icon">
                            <i class="fas fa-search"></i>
                        </button>
                        <button class="btn-icon">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>

                <div class="messages-area" id="messagesContainer">
                    <div class="loading-messages">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Загрузка сообщений...</p>
                    </div>
                </div>

                <div class="message-input-area">
                    <button class="btn-icon">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <div class="input-box">
                        <textarea 
                            id="messageInput" 
                            placeholder="Напишите сообщение..." 
                            rows="1"
                            onkeydown="handleKeyPress(event)"
                            oninput="autoResize(this)"></textarea>
                        <button class="btn-icon">
                            <i class="fas fa-smile"></i>
                        </button>
                    </div>
                    <button class="send-btn" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>

        </main>
    </div>

    <!-- МОДАЛЬНОЕ ОКНО: НОВЫЙ ЧАТ -->
    <div id="newChatDialog" class="modal hidden">
        <div class="modal-overlay" onclick="closeDialog('newChatDialog')"></div>
        <div class="modal-box">
            <div class="modal-head">
                <h3>Новый чат</h3>
                <button class="close-btn" onclick="closeDialog('newChatDialog')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-content">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchUsers" placeholder="Поиск пользователя..." oninput="searchUsers(this.value)">
                </div>
                <div class="users-list" id="usersList">
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <p>Введите username для поиска</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- МОДАЛЬНОЕ ОКНО: ПРОФИЛЬ -->
    <div id="profileDialog" class="modal hidden">
        <div class="modal-overlay" onclick="closeDialog('profileDialog')"></div>
        <div class="modal-box">
            <div class="modal-head">
                <h3>Мой профиль</h3>
                <button class="close-btn" onclick="closeDialog('profileDialog')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-content profile-content">
                <div class="profile-header">
                    <div class="profile-avatar-large">
                        <i class="fas fa-user"></i>
                    </div>
                    <button class="change-photo-btn">
                        <i class="fas fa-camera"></i>
                    </button>
                </div>
                <div class="profile-data">
                    <div class="data-item">
                        <label>Имя</label>
                        <p id="profileName">Загрузка...</p>
                    </div>
                    <div class="data-item">
                        <label>Username</label>
                        <p id="profileUsername">@username</p>
                    </div>
                    <div class="data-item">
                        <label>Email</label>
                        <p id="profileEmail">email@example.com</p>
                    </div>
                </div>
                <button class="logout-btn" onclick="handleLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Выйти из аккаунта</span>
                </button>
            </div>
        </div>
    </div>

    <!-- УВЕДОМЛЕНИЯ -->
    <div id="notifications" class="notifications"></div>

    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- APP -->
    <script src="app.js"></script>

</body>
</html>
